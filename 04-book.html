<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
            "THREE": "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.min.js"
            }
        }
    </script>
</head>

<body>

    <script>
        const book = document.createElement('canvas');
        book.classList.add('book');

        document.body.appendChild(book);

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        book.appendChild(renderer.domElement);

        const ambient = new THREE.AmbientLight(0x222222)
        scene.add(ambient)

        const light = new THREE.DirectionalLight(0xffffff)
        light.position.set(0, 0, 6)
        scene.add(light)

        const loader = new THREE.TextureLoader()

        const urls = [
            "/asssets/images/book/edge.png",
            "/asssets/images/book/spine.png",
            "/asssets/images/book/top.png",
            "/asssets/images/book/bottom.png",
            "/asssets/images/book/front.png",
            "/asssets/images/book/back.png"
        ]

        const materials = urls.map(url => {
            return new THREE.MeshLambertMaterial({
                map: loader.load(url)
            })
        })

        const geometry = new THREE.BoxGeometry(3.5, 5, 0.5);
        const cube = new THREE.Mesh(geometry, materials);
        scene.add(cube);

        camera.position.z = 6;

        let currentTimeline = window.pageYOffset / 3000
        let aimTimeline = window.pageYOffset / 3000

        function animate() {
            requestAnimationFrame(animate);

            currentTimeline += (aimTimeline - currentTimeline) * 0.1

            const rx = currentTimeline * -0.5 + 0.5
            const ry = (currentTimeline * 0.9 + 0.1) * Math.PI * 2

            cube.rotation.set(rx, ry, 0)

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener("scroll", function () {
            aimTimeline = window.pageYOffset / 3000
        })
    </script>
</body>

</html>